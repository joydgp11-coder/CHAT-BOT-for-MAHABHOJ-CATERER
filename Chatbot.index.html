
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Mahabhoj Caterer - Chat Bot</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body {
    margin: 0;
    background: #f3f4f6;
    font-family: "Segoe UI", Arial, sans-serif;
  }
  #chatbot {
    position: fixed;
    top: 50px;
    left: 50px;
    width: 380px;
    height: 560px;
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    display: flex;
    flex-direction: column;
    z-index: 9999;
    transition: top 0.2s ease, left 0.2s ease;
  }
  #header {
    background: #1E3A8A;
    color: #fff;
    padding: 12px;
    cursor: move;
    user-select: none;
    border-top-left-radius: 12px;
    border-top-right-radius: 12px;
  }
  #messages {
    flex: 1;
    padding: 12px;
    overflow-y: auto;
    background: #F9FAFB;
    white-space: pre-wrap;
    line-height: 1.45;
  }
  #inputArea {
    display: flex;
    border-top: 1px solid #ccc;
  }
  #inputArea input {
    flex: 1;
    padding: 12px;
    border: none;
    outline: none;
    font-size: 14px;
  }
  #inputArea button {
    background: #1E3A8A;
    color: #fff;
    border: none;
    padding: 0 14px;
    font-weight: 600;
    cursor: pointer;
  }
  #inputArea button:hover {
    background: #0D9488;
  }
</style>
</head>
<body>
  <div id="chatbot">
    <div id="header">MAHABHOJ CATERER - CHAT BOT</div>
    <div id="messages"></div>
    <div id="inputArea">
      <input id="input" type="text" placeholder="Type your message..." />
      <button id="sendBtn">Send</button>
    </div>
  </div>

<script>
  const messagesEl = document.getElementById('messages');
  function addMsg(text, sender){
    const div = document.createElement('div');
    div.textContent = sender + ": " + text;
    messagesEl.appendChild(div);
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }
  function bot(text){ addMsg(text, "Bot"); }

  // Intent detection with quantity, contact, and service area handling
  function respond(text){
    const t = text.toLowerCase();

    // Extract number of plates if mentioned
    const match = t.match(/(\d+)\s*plate/);
    const qty = match ? parseInt(match[1]) : null;

    // Prices
    const vegPrice = 200;
    const nonPrice = 300;

    // Contact intent
    if(t.includes("contact") || t.includes("phone") || t.includes("number")){
      return "You can find the contact number on our website.";
    }

    // Service area intent
    if(
      (t.includes("where") || t.includes("area") || t.includes("location")) &&
      (t.includes("serve") || t.includes("service"))
    ){
      return "We serve Chandannagar and nearby areas.";
    }

    // Combined query (veg + non‚Äëveg with quantity)
    if(qty && t.includes("veg") && t.includes("non")){
      return `Total cost for ${qty} veg plates is ‚Çπ${qty * vegPrice}, and ${qty} non‚Äëveg plates is ‚Çπ${qty * nonPrice}.`;
    }

    // Non‚Äëveg first (avoid "non veg" matching "veg")
    if(t.includes("non veg") || t.includes("non-veg") || t.includes("chicken") || t.includes("mutton") || t.includes("fish")){
      if(qty){
        return `Total cost for ${qty} non‚Äëveg plates is ‚Çπ${qty * nonPrice}.`;
      }
      if(t.includes("price") || t.includes("cost") || t.includes("rate")){
        return `Non‚Äëveg plate costs ‚Çπ${nonPrice}.`;
      }
      return "Our non‚Äëveg menu includes chicken, mutton, and fish.";
    }

    // Veg intent
    if(t.includes("veg") || t.includes("paneer") || t.includes("dal") || t.includes("sabzi")){
      if(qty){
        return `Total cost for ${qty} veg plates is ‚Çπ${qty * vegPrice}.`;
      }
      if(t.includes("price") || t.includes("cost") || t.includes("rate")){
        return `Veg plate costs ‚Çπ${vegPrice}.`;
      }
      return "Our veg menu includes paneer, dal, and sabzi.";
    }

    // Menu intent
    if(t.includes("menu") || t.includes("items") || t.includes("dishes")){
      return "Our menu includes both veg and non‚Äëveg dishes.";
    }

    // Price intent (generic)
    if(t.includes("price") || t.includes("cost") || t.includes("rate")){
      return `Veg plates start at ‚Çπ${vegPrice}, Non‚Äëveg plates start at ‚Çπ${nonPrice}.`;
    }

    // Fallback
    return "Please ask about veg items, non‚Äëveg items, prices, contact, or service area.";
  }

  document.getElementById('sendBtn').addEventListener('click', ()=>{
    const input = document.getElementById('input');
    const text = input.value.trim();
    if(!text) return;
    addMsg(text, "You");
    input.value = "";
    bot(respond(text));
  });

  document.getElementById('input').addEventListener('keydown', (e)=>{
    if(e.key === 'Enter') document.getElementById('sendBtn').click();
  });

  // Draggable + Snap-to-corner
  (function(){
    const el = document.getElementById('chatbot');
    const header = document.getElementById('header');
    let dragging = false, startX = 0, startY = 0, startLeft = 0, startTop = 0;

    function getRect(){ return el.getBoundingClientRect(); }

    function setPosition(left, top){
      const rect = getRect();
      const w = window.innerWidth;
      const h = window.innerHeight;
      const maxLeft = w - rect.width;
      const maxTop = h - rect.height;
      el.style.left = Math.max(0, Math.min(left, maxLeft)) + "px";
      el.style.top = Math.max(0, Math.min(top, maxTop)) + "px";
    }

    function onDown(clientX, clientY){
      dragging = true;
      const rect = getRect();
      startX = clientX;
      startY = clientY;
      startLeft = rect.left;
      startTop = rect.top;
      document.addEventListener('mousemove', onMove);
      document.addEventListener('mouseup', onUp);
      document.addEventListener('touchmove', onTouchMove, { passive: false });
      document.addEventListener('touchend', onUp);
    }

    function onMove(e){
      if(!dragging) return;
      e.preventDefault();
      const dx = e.clientX - startX;
      const dy = e.clientY - startY;
      setPosition(startLeft + dx, startTop + dy);
    }

    function onTouchMove(e){
      if(!dragging) return;
      e.preventDefault();
      const t = e.touches[0];
      const dx = t.clientX - startX;
      const dy = t.clientY - startY;
      setPosition(startLeft + dx, startTop + dy);
    }

    function snapToCorner(){
      const rect = getRect();
      const w = window.innerWidth;
      const h = window.innerHeight;
      const topDist = rect.top;
      const leftDist = rect.left;
      const rightDist = w - rect.right;
      const bottomDist = h - rect.bottom;
      const tl = topDist + leftDist;
      const tr = topDist + rightDist;
      const bl = bottomDist + leftDist;
      const br = bottomDist + rightDist;
      const min = Math.min(tl, tr, bl, br);
      let targetLeft = 0, targetTop = 0;
      if(min === tl){ targetLeft = 0; targetTop = 0; }
      else if(min === tr){ targetLeft = w - rect.width; targetTop = 0; }
      else if(min === bl){ targetLeft = 0; targetTop = h - rect.height; }
      else { targetLeft = w - rect.width; targetTop = h - rect.height; }
      setPosition(targetLeft, targetTop);
    }

    function onUp(){
      if(!dragging) return;
      dragging = false;
      document.removeEventListener('mousemove', onMove);
      document.removeEventListener('mouseup', onUp);
      document.removeEventListener('touchmove', onTouchMove);
      document.removeEventListener('touchend', onUp);
      snapToCorner();
    }

    header.addEventListener('mousedown', (e)=> onDown(e.clientX, e.clientY));
    header.addEventListener('touchstart', (e)=>{
      const t = e.touches[0];
      onDown(t.clientX, t.clientY);
    }, { passive: true });

    // Keep inside viewport on resize
    window.addEventListener('resize', ()=>{
      const rect = getRect();
      setPosition(rect.left, rect.top);
    });
  })();

  // Greeting
  bot("üçΩÔ∏è Welcome to Mahabhoj Caterer Chatbot! Ask me about veg, non‚Äëveg, prices, totals, contact, or service area. Drag me around!");
</script>
</body>
</html>
